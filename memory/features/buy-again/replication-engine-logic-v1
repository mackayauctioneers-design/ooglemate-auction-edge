# Memory: features/buy-again/replication-engine-logic-v1
Updated: now

The 'Buy Again Targets' engine is an INDIVIDUAL SALE REPLICATION system (not pattern/cluster-based). It pulls the top 20 most profitable individual sales from vehicle_sales_truth and matches each one against live listings.

## Sale Selection
- WHERE buy_price IS NOT NULL AND sale_price IS NOT NULL AND profit >= $4,000
- ORDER BY profit DESC, LIMIT 20
- Each sale is its own replication target block

## Matching Rules (HARD FILTERS, no fuzzy scoring)
- Make: exact match
- Model: exact match
- Year: within ±2 of sale year
- KM: within ±10,000 of sale KM
- Price: listing.asking_price < sale.sale_price
- Drivetrain: hard filter (2WD never matches 4WD/AWD)
- Trim class: exact match OR one-step upgrade via trim_ladder (never downgrade)

## Ranking
- Sort valid matches by asking_price ASC
- Take top 3 cheapest per sale

## Profit Calculation
- est_profit = sale.sale_price - listing.asking_price

## UI
- Each sale shows: year/make/model/trim, bought price, sold price, profit, KM, drivetrain, sold date
- Under each: top 3 matching live listings with EXACT or UPGRADE badge
- Sales with no matches shown separately: "No close matches within spec"
- Dismiss/Restore per sale via localStorage

## NOT statistical, NOT grouped by model, NOT using medians or clusters
