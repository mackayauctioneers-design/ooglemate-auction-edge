# Memory: rules/carbitrage-hunt-rules-v1
Updated: 2026-01-23

## Core Carbitrage Hunt Rules (Australia-wide, always)

### Source Priority Order (reliability-first)
1. **PRIMARY (stable links)**: Gumtree.com.au, Facebook Marketplace, Carma.com.au
2. **SECONDARY**: Drive.com.au classifieds, private seller ads/forums, dealer direct websites
3. **CARSALES-DISCOVERY MODE ONLY**: Carsales.com.au for DATA EXTRACTION only (never as primary link)

### Carsales-Safe Discovery Mode (CRITICAL)
When using carsales.com.au:
- **NEVER** use direct carsales listing URL as primary `link`
- Use carsales ONLY for data extraction: price, km, year, dealer name, dealer license, suburb/postcode
- For every carsales hit:
  1. Extract dealer name + license + suburb from listing
  2. Derive stable `dealer_url`: Search "dealer name + license number + website Australia" → use top dealer site result
  3. If no dealer site found, fall back to carsales dealer profile (`https://www.carsales.com.au/dealer/[dealer-slug]/`)
- Mark source as `carsales-discovery` (not `carsales`)
- Store original carsales URL in `verification_source` (for reference only, not for user clicks)

### Pricing
- ALWAYS use off-road/drive-away excluding govt charges/on-roads/stamp duty
- Focus on advertised price before extras

### Model Year Priority
- Prefer newer (e.g., 2024/2025 MY) if price delta ≤ +$8k off-road compared to similar older equivalent

### Mileage
- Strongly prioritize <50,000 km total (ideally much lower for value)

### Body Type
- Prioritize hatchbacks and sedans
- Avoid SUVs/crossovers unless exceptional deal (e.g., off-road price steal under $25k with low km/history)

### Seller Type
- Heavily favor private/motivated sellers (distressed sales, quick flips)
- Include dealers only if certified pre-owned + full service history + competitive pricing

### Metrics
- Always calculate $/km (lower = better)
- Include brutal honesty—no weak/sideways options
- Flag any red flags (e.g., accident history, poor condition, potential sold/expired status)

### Output Format (Strict JSON)
```json
{
  "opportunities": [
    {
      "make_model_year": "2024 Hyundai i30 N Line Premium",
      "km": 10000,
      "off_road_price_aud": 30990,
      "dollars_per_km": 3.099,
      "source": "gumtree|facebook|carma|drive|dealer-direct|carsales-discovery",
      "link": "https://www.exampledealer.com.au/stock/12345",
      "verification_source": "https://www.carsales.com.au/cars/details/..." | null,
      "dealer_name": "Sydney Auto Hub" | null,
      "dealer_license": "MD12345" | null,
      "fallback_search_query": "2024 Hyundai i30 N Line Premium Sydney low km",
      "seller_type": "private|dealer|certified",
      "notes": "Data verified from carsales but linked to dealer site for reliability—no direct carsales click.",
      "comparison_to_recent_wins": "how it stacks up",
      "red_flags": "any concerns or 'none'"
    }
  ],
  "summary": "Prioritized stable sources; carsales used for discovery only with dealer site links."
}
```

### Recent Wins/Benchmarks
- 2024 Hyundai i30 N Line Premium, ~10k km, $30,990 off-road (strong private buy)
- Considering 2025 MY25 i30 upgrade ~9k km at $37,990 off-road if delta justified

### Technical Integration
- XAI_API_KEY env var for Grok/xAI calls
- Force JSON output via system prompt
- Force source priority in queries: Gumtree/FB/Carma FIRST
- Carsales = discovery mode only (extract data → derive dealer URL → link to dealer)
- Add verification_source for audit trail
