# Memory: rules/carbitrage-hunt-rules-v1
Updated: 2026-01-23

## Core Carbitrage Hunt Rules (Australia-wide, always)

### Source Priority Order (reliability-first)
1. **PRIMARY (stable links)**: Gumtree.com.au, Facebook Marketplace, Carma.com.au
2. **SECONDARY**: Drive.com.au classifieds, private seller ads/forums, dealer direct websites
3. **CARSALES-DISCOVERY MODE ONLY**: Carsales.com.au for DATA EXTRACTION only (never as primary link)

### Carsales-Safe Discovery Mode (CRITICAL)
When using carsales.com.au:
- **NEVER** use direct carsales listing URL as primary `link`
- Use carsales ONLY for data extraction: price, km, year, dealer name, dealer license, suburb/postcode
- For every carsales hit:
  1. Extract dealer name + license + suburb from listing
  2. Derive stable `dealer_url`: Search "dealer name + license number + website Australia" → use top dealer site result
  3. If no dealer site found, fall back to carsales dealer profile (`https://www.carsales.com.au/dealer/[dealer-slug]/`)
- Mark source as `carsales-discovery` (not `carsales`)
- Store original carsales URL in `verification_source` (for reference only, not for user clicks)

### Pricing
- ALWAYS use off-road/drive-away excluding govt charges/on-roads/stamp duty
- Focus on advertised price before extras

### Model Year Priority
- Prefer newer (e.g., 2024/2025 MY) if price delta ≤ +$8k off-road compared to similar older equivalent

### Mileage
- Strongly prioritize <50,000 km total (ideally much lower for value)

### Body Type
- Prioritize hatchbacks and sedans
- Avoid SUVs/crossovers unless exceptional deal (e.g., off-road price steal under $25k with low km/history)

### Seller Type
- Heavily favor private/motivated sellers (distressed sales, quick flips)
- Include dealers only if certified pre-owned + full service history + competitive pricing

### Metrics
- Always calculate $/km (lower = better)
- Include brutal honesty—no weak/sideways options
- Flag any red flags (e.g., accident history, poor condition, potential sold/expired status)

---

## Geographic Intelligence (Geo Layer)

### Purpose
Carbitrage uses geographic context to understand where vehicles move, where they clear fastest, and where mispricing is most likely to occur. This prevents metro bias and unlocks regional arbitrage.

### Geo Normalisation
All vehicles are normalised to geographic identifiers:
- State
- Postcode
- Suburb
- SA2 / SA3 (ABS statistical areas)
- Latitude / longitude

This allows consistent comparison across dealer listings, auctions, private sales, and historical exits.

### Regional Liquidity Mapping
The system tracks clearance velocity by region, not just nationally.
- Some models clear faster in QLD regional than Sydney metro
- Certain utes / 4WDs have stronger demand in WA / NT
- Metro pricing can be misleading for regional exits

Vehicles are scored differently depending on where they are located AND where they are likely to exit.

### Geo Price Dislocation Detection
The system looks for regional price mismatches:
- Cheap regional listings for vehicles that exit strongly in metro
- Metro listings that are overpriced relative to nearby regions
- Dealers consistently underpricing in certain postcodes

These are treated as **geo-arbitrage opportunities**, not generic bargains.

### Freight & Distance Cost Modelling
Location is not a hard exclusion—it's a cost modifier.

**Baseline freight assumptions:**
- NSW ↔ QLD ↔ VIC: ~$1,000 freight
- Tasmania: ~$1,300 freight
- WA / NT: ~$1,800-2,500 freight

This allows:
- Remote vehicles to remain viable
- Proper margin calculation after logistics
- Avoiding knee-jerk "too far" rejections

### Dealer Geo Strength Profiles
Dealers implicitly develop regional strengths:
- Dealer A clears Hiluxes fast in FNQ
- Dealer B dominates metro Sydney prestige
- Dealer C moves LandCruisers well in WA

These patterns inform matching vehicles to the right dealer by region.

### Geo-Aware Watchlists
Watchlists can be geo-scoped:
- "Only alert if in NSW/QLD"
- "Alert if regional VIC under X price"
- "Ignore metro Sydney noise"

This reduces alert fatigue and improves signal quality.

### Geo Heatmaps
The system tracks:
- Heatmaps of listings disappearing (sold)
- Heatmaps of repeated auction failures
- Model-specific regional demand maps

This allows visual understanding of market flow and faster conviction on marginal deals.

### Interaction with Grok (CRITICAL)
Grok is geo-blind by default unless instructed. Carbitrage adds value by:
- Interpreting Grok's finds through geo context
- Discounting "cheap" cars in weak exit regions
- Elevating "normal" priced cars in strong exit regions

**Grok finds the car. Carbitrage decides if the location makes sense.**

### Geo-Specific Questions for Every Hunt
1. What's the regional clearance velocity for this model?
2. Does the listing location match known strong exit regions?
3. Is this "cheap" because of location (weak region) or genuine underpricing?
4. What's the freight cost to a strong exit region?
5. Are there dealer clusters that consistently underprice stock regionally?

---

## Output Format (Strict JSON)
```json
{
  "opportunities": [
    {
      "make_model_year": "2024 Hyundai i30 N Line Premium",
      "km": 10000,
      "off_road_price_aud": 30990,
      "dollars_per_km": 3.099,
      "source": "gumtree|facebook|carma|drive|dealer-direct|carsales-discovery",
      "link": "https://www.exampledealer.com.au/stock/12345",
      "verification_source": "https://www.carsales.com.au/cars/details/..." | null,
      "dealer_name": "Sydney Auto Hub" | null,
      "dealer_license": "MD12345" | null,
      "fallback_search_query": "2024 Hyundai i30 N Line Premium Sydney low km",
      "seller_type": "private|dealer|certified",
      "location": "Sydney NSW",
      "state": "NSW",
      "postcode": "2000",
      "geo_exit_strength": "HIGH|MEDIUM|LOW|UNKNOWN",
      "geo_notes": "Sydney metro strong exit region for i30; no freight needed",
      "estimated_freight_cost": 0,
      "notes": "Data verified from carsales but linked to dealer site for reliability—no direct carsales click.",
      "comparison_to_recent_wins": "how it stacks up",
      "red_flags": "any concerns or 'none'"
    }
  ],
  "summary": "Prioritized stable sources; carsales used for discovery only with dealer site links. Geo context applied."
}
```

### Recent Wins/Benchmarks
- 2024 Hyundai i30 N Line Premium, ~10k km, $30,990 off-road (strong private buy)
- Considering 2025 MY25 i30 upgrade ~9k km at $37,990 off-road if delta justified

### Technical Integration
- XAI_API_KEY env var for Grok/xAI calls
- Force JSON output via system prompt
- Force source priority in queries: Gumtree/FB/Carma FIRST
- Carsales = discovery mode only (extract data → derive dealer URL → link to dealer)
- Add verification_source for audit trail
- Apply geo intelligence layer to all hunt outputs
